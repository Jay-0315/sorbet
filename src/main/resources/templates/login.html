<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>SORBET 로그인</title>
  <link rel="stylesheet" th:href="@{/css/login.css}">
  <style>
    .error { color: red; margin-top: 5px; }
  </style>
</head>
<body>
<div class="login-wrapper">
  <h2 class="use-crayon-font">SORBET.</h2>

  <img src="/images/sorbetRabit.png" alt="토끼" class="sorbetRabit" />


  <!-- 오류 메시지 표시 -->
  <div class="error" id="error-message" style="display:none;"></div>

  <form id="login-form">
    <div class="form-group">
      <label for="userId">아이디</label>
      <input type="text" id="userId" name="userId" placeholder="아이디 입력" required>
    </div>

    <div class="form-group">
      <label for="password">비밀번호</label>
      <input type="password" id="password" name="password" placeholder="비밀번호 입력" required>
    </div>

    <button type="submit">로그인</button>
  </form>

  <p class="signup-text">계정이 없으신가요? <a th:href="@{/register}">회원가입</a></p>
</div>

<script>
  document.getElementById('login-form').addEventListener('submit', async function (e) {
    e.preventDefault();

    const userId = document.getElementById('userId').value;
    const password = document.getElementById('password').value;

    const response = await fetch('/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ userId, password }),
      credentials: "include"
    });

    if (response.ok) {
      // 로그인 성공 후 이동할 페이지 (예: 마이페이지)
      window.location.href = '/home';
    } else {
      // 에러 메시지 표시
      const result = await response.json().catch(() => ({}));
      document.getElementById('error-message').style.display = 'block';
      document.getElementById('error-message').innerText =
              result?.error || '로그인에 실패했습니다.';
    }
  });
</script>
</body>
</html>
