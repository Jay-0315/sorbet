<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="kr">
<head>
  <meta charset="UTF-8">
  <title>홈 | Sorbet</title>
  <link rel="stylesheet" href="/css/home.css">
</head>
<body>
<sec:authorize access="isAuthenticated()">
  <div class="user-menu-fixed">
    <a href="/mypage" class="user-btn1">마이페이지</a>
    <a href="/gatcha" class="user-btn3">sorbet friends!</a>
    <form th:action="@{/logout}" method="post" style="display:inline">
      <button type="submit" class="user-btn2">로그아웃</button>
    </form>
  </div>
</sec:authorize>


<div class="sorbet-logo">SORBET.</div>

<form th:action="@{/home}" method="get" class="search-form">
  <input type="text" name="keyword" th:value="${searchKeyword}" placeholder="검색어 입력">
  <button type="submit" class="search-btn">SEARCH</button>
</form>

<sec:authorize access="isAuthenticated()">
</sec:authorize>

<!-- NEW: 그리드형 게시판 -->
<div class="board-wrap">
  <!-- 가로 카테고리 필터 -->
  <div class="filters">
    <button class="filter-btn" data-category="all"
            th:classappend="${selectedCategory} == 'all' ? ' active' : ''">전체</button>
    <button class="filter-btn" data-category="love"
            th:classappend="${selectedCategory} == 'love' ? ' active' : ''">연애</button>
    <button class="filter-btn" data-category="friend"
            th:classappend="${selectedCategory} == 'friend' ? ' active' : ''">친구</button>
    <button class="filter-btn" data-category="life"
            th:classappend="${selectedCategory} == 'life' ? ' active' : ''">인생</button>
    <button class="filter-btn" data-category="etc"
            th:classappend="${selectedCategory} == 'etc' ? ' active' : ''">기타</button>
  </div>
  <div>
    <p class="user-greeting" th:if="${nickname}" th:text="'안녕하세요, ' + ${nickname} + '님!'"></p>
  </div>

  <!-- 카드 그리드 -->
  <div class="grid-cards" th:if="${posts != null}">
    <a class="card" th:each="post : ${posts}" th:href="@{|/posts/${post.id}|}">
      <div class="thumb">
        <img th:if="${post.thumbnailUrl != null}" th:src="${post.thumbnailUrl}" alt="thumbnail">
        <div class="thumb--placeholder" th:if="${post.thumbnailUrl == null}">SORBET</div>
        <span class="chip" th:text="${post.category}">카테고리</span>
      </div>
      <div class="card-body">
        <h3 class="card-title" th:text="${post.title}">제목</h3>
        <div class="meta">
          <span th:text="${#temporals.format(post.createdAt, 'yyyy.MM.dd')}">2025.08.12</span>
          <span class="dot">·</span>
          <span th:text="'조회 ' + ${post.views}">조회 0</span>
          <span class="dot">·</span>
          <span th:text="'좋아요 ' + ${post.likeCount}">좋아요 0</span>
        </div>
      </div>
    </a>
  </div>

  <div th:if="${posts == null or posts.isEmpty()}" class="empty">
    등록된 글이 없습니다.
  </div>
</div>

<!-- 페이징 -->
<div class="pagination" th:if="${totalPages > 1}">
  <span th:if="${currentPage > 0}">
    <a th:href="@{/home(category=${selectedCategory}, page=${currentPage - 1})}">이전</a>
  </span>

  <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
    <a th:href="@{/home(category=${selectedCategory}, page=${i})}"
       th:text="${i + 1}"
       th:classappend="${i == currentPage} ? ' current-page' : ''">1</a>
  </span>

  <span th:if="${currentPage < totalPages - 1}">
    <a th:href="@{/home(category=${selectedCategory}, page=${currentPage + 1})}">다음</a>
  </span>
</div>

<a href="/createpost" class="btn-write">글쓰기</a>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const c = btn.dataset.category;
        if (c === 'all') location.href = '/home';
        else location.href = '/home?category=' + c;
      });
    });
  });
</script>
</body>
</html>
