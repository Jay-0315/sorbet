<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="kr">
<head>
  <meta charset="UTF-8">
  <title>í™ˆ | Sorbet</title>
  <link rel="stylesheet" href="/css/home.css">
</head>
<body>
<sec:authorize access="isAuthenticated()">
  <div class="user-menu-fixed">
    <a href="/mypage" class="user-btn1">ë§ˆì´í˜ì´ì§€</a>
    <form th:action="@{/logout}" method="post" style="display:inline">
      <button type="submit" class="user-btn2">ë¡œê·¸ì•„ì›ƒ</button>
    </form>
  </div>
</sec:authorize>


<div class="sorbet-logo">Sorbet.</div>
<h1 class="main-title">ë­ë“ ì§€ ë¬»ê³ , ë‹µí•˜ì„¸ìš” Sorbet, Solve at</h1>
<form th:action="@{/home}" method="get" class="search-form">
  <input type="text" name="keyword" th:value="${searchKeyword}" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
  <button type="submit" class="search-btn">ğŸ”ê²€ìƒ‰</button>
</form>

<sec:authorize access="isAuthenticated()">
  <p class="user-greeting" th:if="${nickname}" th:text="'ì•ˆë…•í•˜ì„¸ìš”, ' + ${nickname} + 'ë‹˜!'"></p>
</sec:authorize>





  <div class="layout">
  <div class="sidebar">
    <h2>ì¹´í…Œê³ ë¦¬</h2>


    <button class="nav-btn"
            data-category="all"
            th:classappend="${selectedCategory} == 'all' ? ' active' : ''">ì „ì²´</button>

    <button class="nav-btn"
            data-category="love"
            th:classappend="${selectedCategory} == 'love' ? ' active' : ''">ì—°ì• </button>

    <button class="nav-btn"
            data-category="friend"
            th:classappend="${selectedCategory} == 'friend' ? ' active' : ''">ì¹œêµ¬</button>

    <button class="nav-btn"
            data-category="life"
            th:classappend="${selectedCategory} == 'life' ? ' active' : ''">ì¸ìƒ</button>

    <button class="nav-btn"
            data-category="etc"
            th:classappend="${selectedCategory} == 'etc' ? ' active' : ''">ê¸°íƒ€</button>

    <img src="/images/runningRabits.png" alt="ë‹¬ë¦¬ëŠ” í† ë¼" class="sidebar-image"/>
  </div>

  <div class="content">
    <div th:if="${posts != null and posts.isEmpty()}">
      <p>ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>


    <div th:each="post : ${posts}" class="post-box">
      <div class="post-header">
        <div>
      <div class="category" th:text="${post.category}">ì¹´í…Œê³ ë¦¬</div>

      <a class="post-title" th:href="@{|/posts/${post.id}|}" th:text="${post.title}">ì œëª©</a>

      <p class="writer" th:text="'ğŸ°ì‘ì„±ì: ' + ${post.writer}">ì‘ì„±ì</p>
        </div>

      <img th:if="${post.thumbnailUrl != null}" th:src="${post.thumbnailUrl}" class="thumbnail" />
      </div>
      <!-- ì˜¤ë¥¸ìª½ í•˜ë‹¨ ë©”íƒ€ ì •ë³´ -->
      <div class="footer-meta">
        <span class="viewCount" th:text="'ì¡°íšŒìˆ˜: ' + ${post.views}">ì¡°íšŒìˆ˜</span>
        <span class="likeCount" th:text="'ì¢‹ì•„ìš”: ' + ${post.likeCount}">ì¢‹ì•„ìš”</span>
        <span class="date" th:text="'ì‘ì„±ì¼ì: ' + ${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</span>
      </div>
    </div>

  </div>
</div>
<!-- í˜ì´ì§• -->
<div class="pagination" th:if="${totalPages > 1}">
  <span th:if="${currentPage > 0}">
    <a th:href="@{/home(category=${selectedCategory}, page=${currentPage - 1})}">ì´ì „</a>
  </span>

  <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
    <a th:href="@{/home(category=${selectedCategory}, page=${i})}"
       th:text="${i + 1}"
       th:classappend="${i == currentPage} ? ' current-page' : ''">1</a>
  </span>

  <span th:if="${currentPage < totalPages - 1}">
    <a th:href="@{/home(category=${selectedCategory}, page=${currentPage + 1})}">ë‹¤ìŒ</a>
  </span>
</div>

  <a href="/createpost" class="btn-write">ê¸€ì“°ê¸°</a>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const navButtons = document.querySelectorAll('.nav-btn');
    navButtons.forEach(button => {
      button.addEventListener('click', function () {
        const category = this.dataset.category;
        if (category === 'all') {
          window.location.href = '/home';
        } else {
          window.location.href = '/home?category=' + category;
        }
      });
    });
  });
</script>
</body>
</html>
